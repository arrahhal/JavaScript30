<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>Type Ahead ðŸ‘€</title>
	<link rel="stylesheet" href="style.css" />
	<link rel="icon" href="https://fav.farm/ðŸ”¥" />
</head>

<body>
	<form class="search-form">
		<input type="text" class="search" placeholder="City or State" id="search-input" />
		<ul class="suggestions">
			<li>Filter for a city</li>
			<li>or a state</li>
		</ul>
	</form>
	<script>
		const endpoint =
			"https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json";
		const searchInput = document.getElementById("search-input");
		const suggestions = document.querySelector('.suggestions');
		let cities;
		let isFetched = false;

		async function doStuff(e) {
			fetch(endpoint, {
				method: "GET",
			})
				.then((data) => data.json()).then(json => {
					cities = json;
					isFetched = true;
					suggestions.innerHTML = '';
					json.forEach(city => {
						suggestions.innerHTML += `<li><div>${city.city}</div><div>${city.population}</div></li>`;
					});
				});
		}

		async function filterStuff(e) {
			while (!isFetched) await new Promise(resolve => setTimeout(() => resolve(), 1000));
			const query = e.target.value;
			suggestions.innerHTML = '';
			cities.forEach(city => {
				if (city.city.includes(query)) {
					suggestions.innerHTML += `<li><div>${city.city.replace(query, `<span class='hl'>${query}</span>`)}</div><div>${city.population}</div></li>`;
				}
			});
		}
		searchInput.addEventListener("click", doStuff, {once: true});
		searchInput.addEventListener("input", filterStuff);
	</script>
</body>

</html>
